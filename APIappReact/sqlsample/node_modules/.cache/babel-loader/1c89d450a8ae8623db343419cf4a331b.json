{"ast":null,"code":"'use strict';\n\nconst TYPES = require('./datatypes').TYPES;\n\nconst declareType = require('./datatypes').declare;\n\nconst objectHasProperty = require('./utils').objectHasProperty;\n\nconst MAX = 65535; // (1 << 16) - 1\n\nconst JSON_COLUMN_ID = 'JSON_F52E2B61-18A1-11d1-B105-00805F49916B';\n\nfunction Table(name) {\n  if (name) {\n    const parsed = Table.parseName(name);\n    this.name = parsed.name;\n    this.schema = parsed.schema;\n    this.database = parsed.database;\n    this.path = (this.database ? `[${this.database}].` : '') + (this.schema ? `[${this.schema}].` : '') + `[${this.name}]`;\n    this.temporary = this.name.charAt(0) === '#';\n  }\n\n  this.columns = [];\n  this.rows = [];\n  Object.defineProperty(this.columns, 'add', {\n    value(name, column, options) {\n      if (column == null) {\n        throw new Error('Column data type is not defined.');\n      }\n\n      if (column instanceof Function) {\n        column = column();\n      }\n\n      options = options || {};\n      column.name = name;\n      column.nullable = options.nullable;\n      column.primary = options.primary;\n\n      if (objectHasProperty(options, 'length')) {\n        column.length = options.length;\n      }\n\n      return this.push(column);\n    }\n\n  });\n  Object.defineProperty(this.rows, 'add', {\n    value() {\n      return this.push(Array.prototype.slice.call(arguments));\n    }\n\n  });\n}\n/*\r\n@private\r\n*/\n\n\nTable.prototype._makeBulk = function _makeBulk() {\n  for (let i = 0; i < this.columns.length; i++) {\n    const col = this.columns[i];\n\n    switch (col.type) {\n      case TYPES.Date:\n      case TYPES.DateTime:\n      case TYPES.DateTime2:\n        for (let j = 0; j < this.rows.length; j++) {\n          const dateValue = this.rows[j][i];\n\n          if (typeof dateValue === 'string' || typeof dateValue === 'number') {\n            const date = new Date(dateValue);\n\n            if (isNaN(date.getDate())) {\n              throw new TypeError('Invalid date value passed to bulk rows');\n            }\n\n            this.rows[j][i] = date;\n          }\n        }\n\n        break;\n\n      case TYPES.Xml:\n        col.type = TYPES.NVarChar(MAX).type;\n        break;\n\n      case TYPES.UDT:\n      case TYPES.Geography:\n      case TYPES.Geometry:\n        col.type = TYPES.VarBinary(MAX).type;\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  return this;\n};\n\nTable.prototype.declare = function declare() {\n  const pkey = this.columns.filter(col => col.primary === true).map(col => col.name);\n  const cols = this.columns.map(col => {\n    const def = [`[${col.name}] ${declareType(col.type, col)}`];\n\n    if (col.nullable === true) {\n      def.push('null');\n    } else if (col.nullable === false) {\n      def.push('not null');\n    }\n\n    if (col.primary === true && pkey.length === 1) {\n      def.push('primary key');\n    }\n\n    return def.join(' ');\n  });\n  const constraint = pkey.length > 1 ? `, constraint PK_${this.temporary ? this.name.substr(1) : this.name} primary key (${pkey.join(', ')})` : '';\n  return `create table ${this.path} (${cols.join(', ')}${constraint})`;\n};\n\nTable.fromRecordset = function fromRecordset(recordset, name) {\n  const t = new this(name);\n\n  for (const colName in recordset.columns) {\n    if (objectHasProperty(recordset.columns, colName)) {\n      const col = recordset.columns[colName];\n      t.columns.add(colName, {\n        type: col.type,\n        length: col.length,\n        scale: col.scale,\n        precision: col.precision\n      }, {\n        nullable: col.nullable\n      });\n    }\n  }\n\n  if (t.columns.length === 1 && t.columns[0].name === JSON_COLUMN_ID) {\n    for (let i = 0; i < recordset.length; i++) {\n      t.rows.add(JSON.stringify(recordset[i]));\n    }\n  } else {\n    for (let i = 0; i < recordset.length; i++) {\n      t.rows.add.apply(t.rows, t.columns.map(col => recordset[i][col.name]));\n    }\n  }\n\n  return t;\n};\n\nTable.parseName = function parseName(name) {\n  const length = name.length;\n  let cursor = -1;\n  let buffer = '';\n  let escaped = false;\n  const path = [];\n\n  while (++cursor < length) {\n    const char = name.charAt(cursor);\n\n    if (char === '[') {\n      if (escaped) {\n        buffer += char;\n      } else {\n        escaped = true;\n      }\n    } else if (char === ']') {\n      if (escaped) {\n        escaped = false;\n      } else {\n        throw new Error('Invalid table name.');\n      }\n    } else if (char === '.') {\n      if (escaped) {\n        buffer += char;\n      } else {\n        path.push(buffer);\n        buffer = '';\n      }\n    } else {\n      buffer += char;\n    }\n  }\n\n  if (buffer) {\n    path.push(buffer);\n  }\n\n  switch (path.length) {\n    case 1:\n      return {\n        name: path[0],\n        schema: null,\n        database: null\n      };\n\n    case 2:\n      return {\n        name: path[1],\n        schema: path[0],\n        database: null\n      };\n\n    case 3:\n      return {\n        name: path[2],\n        schema: path[1],\n        database: path[0]\n      };\n\n    default:\n      throw new Error('Invalid table name.');\n  }\n};\n\nmodule.exports = Table;","map":{"version":3,"sources":["C:/Projects/sqlsample/node_modules/mssql/lib/table.js"],"names":["TYPES","require","declareType","declare","objectHasProperty","MAX","JSON_COLUMN_ID","Table","name","parsed","parseName","schema","database","path","temporary","charAt","columns","rows","Object","defineProperty","value","column","options","Error","Function","nullable","primary","length","push","Array","prototype","slice","call","arguments","_makeBulk","i","col","type","Date","DateTime","DateTime2","j","dateValue","date","isNaN","getDate","TypeError","Xml","NVarChar","UDT","Geography","Geometry","VarBinary","pkey","filter","map","cols","def","join","constraint","substr","fromRecordset","recordset","t","colName","add","scale","precision","JSON","stringify","apply","cursor","buffer","escaped","char","module","exports"],"mappings":"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","sourcesContent":["'use strict'\r\n\r\nconst TYPES = require('./datatypes').TYPES\r\nconst declareType = require('./datatypes').declare\r\nconst objectHasProperty = require('./utils').objectHasProperty\r\n\r\nconst MAX = 65535 // (1 << 16) - 1\r\nconst JSON_COLUMN_ID = 'JSON_F52E2B61-18A1-11d1-B105-00805F49916B'\r\n\r\nfunction Table (name) {\r\n  if (name) {\r\n    const parsed = Table.parseName(name)\r\n    this.name = parsed.name\r\n    this.schema = parsed.schema\r\n    this.database = parsed.database\r\n    this.path = (this.database ? `[${this.database}].` : '') + (this.schema ? `[${this.schema}].` : '') + `[${this.name}]`\r\n    this.temporary = this.name.charAt(0) === '#'\r\n  }\r\n\r\n  this.columns = []\r\n  this.rows = []\r\n\r\n  Object.defineProperty(this.columns, 'add', {\r\n    value (name, column, options) {\r\n      if (column == null) {\r\n        throw new Error('Column data type is not defined.')\r\n      }\r\n      if (column instanceof Function) {\r\n        column = column()\r\n      }\r\n\r\n      options = options || {}\r\n      column.name = name\r\n      column.nullable = options.nullable\r\n      column.primary = options.primary\r\n      if (objectHasProperty(options, 'length')) {\r\n        column.length = options.length\r\n      }\r\n\r\n      return this.push(column)\r\n    }\r\n  }\r\n  )\r\n\r\n  Object.defineProperty(this.rows, 'add', {\r\n    value () {\r\n      return this.push(Array.prototype.slice.call(arguments))\r\n    }\r\n  }\r\n  )\r\n}\r\n\r\n/*\r\n@private\r\n*/\r\n\r\nTable.prototype._makeBulk = function _makeBulk () {\r\n  for (let i = 0; i < this.columns.length; i++) {\r\n    const col = this.columns[i]\r\n    switch (col.type) {\r\n      case TYPES.Date:\r\n      case TYPES.DateTime:\r\n      case TYPES.DateTime2:\r\n        for (let j = 0; j < this.rows.length; j++) {\r\n          const dateValue = this.rows[j][i]\r\n          if (typeof dateValue === 'string' || typeof dateValue === 'number') {\r\n            const date = new Date(dateValue)\r\n            if (isNaN(date.getDate())) {\r\n              throw new TypeError('Invalid date value passed to bulk rows')\r\n            }\r\n            this.rows[j][i] = date\r\n          }\r\n        }\r\n        break\r\n\r\n      case TYPES.Xml:\r\n        col.type = TYPES.NVarChar(MAX).type\r\n        break\r\n\r\n      case TYPES.UDT:\r\n      case TYPES.Geography:\r\n      case TYPES.Geometry:\r\n        col.type = TYPES.VarBinary(MAX).type\r\n        break\r\n\r\n      default:\r\n        break\r\n    }\r\n  }\r\n\r\n  return this\r\n}\r\n\r\nTable.prototype.declare = function declare () {\r\n  const pkey = this.columns.filter(col => col.primary === true).map(col => col.name)\r\n  const cols = this.columns.map(col => {\r\n    const def = [`[${col.name}] ${declareType(col.type, col)}`]\r\n\r\n    if (col.nullable === true) {\r\n      def.push('null')\r\n    } else if (col.nullable === false) {\r\n      def.push('not null')\r\n    }\r\n\r\n    if (col.primary === true && pkey.length === 1) {\r\n      def.push('primary key')\r\n    }\r\n\r\n    return def.join(' ')\r\n  })\r\n\r\n  const constraint = pkey.length > 1 ? `, constraint PK_${this.temporary ? this.name.substr(1) : this.name} primary key (${pkey.join(', ')})` : ''\r\n  return `create table ${this.path} (${cols.join(', ')}${constraint})`\r\n}\r\n\r\nTable.fromRecordset = function fromRecordset (recordset, name) {\r\n  const t = new this(name)\r\n\r\n  for (const colName in recordset.columns) {\r\n    if (objectHasProperty(recordset.columns, colName)) {\r\n      const col = recordset.columns[colName]\r\n\r\n      t.columns.add(colName, {\r\n        type: col.type,\r\n        length: col.length,\r\n        scale: col.scale,\r\n        precision: col.precision\r\n      }, {\r\n        nullable: col.nullable\r\n      })\r\n    }\r\n  }\r\n\r\n  if (t.columns.length === 1 && t.columns[0].name === JSON_COLUMN_ID) {\r\n    for (let i = 0; i < recordset.length; i++) {\r\n      t.rows.add(JSON.stringify(recordset[i]))\r\n    }\r\n  } else {\r\n    for (let i = 0; i < recordset.length; i++) {\r\n      t.rows.add.apply(t.rows, t.columns.map(col => recordset[i][col.name]))\r\n    }\r\n  }\r\n\r\n  return t\r\n}\r\n\r\nTable.parseName = function parseName (name) {\r\n  const length = name.length\r\n  let cursor = -1\r\n  let buffer = ''\r\n  let escaped = false\r\n  const path = []\r\n\r\n  while (++cursor < length) {\r\n    const char = name.charAt(cursor)\r\n    if (char === '[') {\r\n      if (escaped) {\r\n        buffer += char\r\n      } else {\r\n        escaped = true\r\n      }\r\n    } else if (char === ']') {\r\n      if (escaped) {\r\n        escaped = false\r\n      } else {\r\n        throw new Error('Invalid table name.')\r\n      }\r\n    } else if (char === '.') {\r\n      if (escaped) {\r\n        buffer += char\r\n      } else {\r\n        path.push(buffer)\r\n        buffer = ''\r\n      }\r\n    } else {\r\n      buffer += char\r\n    }\r\n  }\r\n\r\n  if (buffer) {\r\n    path.push(buffer)\r\n  }\r\n\r\n  switch (path.length) {\r\n    case 1:\r\n      return {\r\n        name: path[0],\r\n        schema: null,\r\n        database: null\r\n      }\r\n\r\n    case 2:\r\n      return {\r\n        name: path[1],\r\n        schema: path[0],\r\n        database: null\r\n      }\r\n\r\n    case 3:\r\n      return {\r\n        name: path[2],\r\n        schema: path[1],\r\n        database: path[0]\r\n      }\r\n\r\n    default:\r\n      throw new Error('Invalid table name.')\r\n  }\r\n}\r\n\r\nmodule.exports = Table\r\n"]},"metadata":{},"sourceType":"script"}